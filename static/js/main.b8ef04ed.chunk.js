(this["webpackJsonppfsense-user-import"]=this["webpackJsonppfsense-user-import"]||[]).push([[0],{42:function(e,a,t){e.exports=t(54)},54:function(e,a,t){"use strict";t.r(a);var r=t(5),n=t(7),l=t(6),o=t.n(l),s=t(28),u=t(11),c=t(0),m=t.n(c),d=t(18),i=t.n(d),p=t(56),f=t(59),E=t(57),v=t(33),b=t(61),w=t(62),h=t(60),y=t(58),I=t(63),C=t(40),g=t(32),P=t(25),L=t.n(P),G=t(30),$=function(e){var a=e.register,t=Object(G.a)(e,["register"]);return m.a.createElement(m.a.Fragment,null,m.a.createElement(f.a.Group,{controlId:"username"},m.a.createElement(f.a.Label,null,"Username"),m.a.createElement(f.a.Control,{name:"columns.name",as:"select",ref:a,required:!0},t.columns.map((function(e){return m.a.createElement("option",{key:e,value:e},e)})))),m.a.createElement(f.a.Group,{controlId:"password"},m.a.createElement(f.a.Label,null,"Password"),m.a.createElement(f.a.Control,{name:"columns.bcrypt-hash",as:"select",ref:a,required:!0},t.columns.map((function(e){return m.a.createElement("option",{key:e,value:e},e)})))),m.a.createElement(f.a.Group,{controlId:"description"},m.a.createElement(f.a.Label,null,"Full name"),m.a.createElement(f.a.Control,{name:"columns.descr",as:"select",ref:a},t.columns.map((function(e){return m.a.createElement("option",{key:e,value:e},e)})))))},x=function(e){var a=e.register,t=Object(G.a)(e,["register"]);return m.a.createElement(m.a.Fragment,null,m.a.createElement(f.a.Group,{controlId:"username"},m.a.createElement(f.a.Label,null,"Username"),m.a.createElement(f.a.Control,{name:"columns.varusersusername",as:"select",ref:a,required:!0},t.columns.map((function(e){return m.a.createElement("option",{key:e,value:e},e)})))),m.a.createElement(f.a.Group,{controlId:"password"},m.a.createElement(f.a.Label,null,"Password"),m.a.createElement(f.a.Control,{name:"columns.varuserspassword",as:"select",ref:a,required:!0},t.columns.map((function(e){return m.a.createElement("option",{key:e,value:e},e)})))),m.a.createElement(f.a.Group,{controlId:"description"},m.a.createElement(f.a.Label,null,"Description"),m.a.createElement(f.a.Control,{name:"columns.description",as:"select",ref:a},t.columns.map((function(e){return m.a.createElement("option",{key:e,value:e},e)})))))},k=function(e){var a=e.register;return m.a.createElement(m.a.Fragment,null,m.a.createElement("input",{type:"hidden",name:"defaults.scope",value:"user",ref:a}),m.a.createElement("input",{type:"hidden",name:"defaults.authorizedkeys",value:"",ref:a}),m.a.createElement("input",{type:"hidden",name:"defaults.ipsecpsk",value:"",ref:a}),m.a.createElement(f.a.Group,{controlId:"descr"},m.a.createElement(f.a.Label,null,"Full name"),m.a.createElement(f.a.Control,{name:"defaults.descr",defaultValue:"Imported user",ref:a})),m.a.createElement(f.a.Group,{controlId:"expires"},m.a.createElement(f.a.Label,null,"Expiration"),m.a.createElement(f.a.Control,{name:"defaults.expires",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"dashboardcolumns"},m.a.createElement(f.a.Label,null,"Dashboard columns"),m.a.createElement(f.a.Control,{name:"defaults.dashboardcolumns",defaultValue:"2",ref:a})),m.a.createElement(f.a.Group,{controlId:"webguicss"},m.a.createElement(f.a.Label,null,"Theme"),m.a.createElement(f.a.Control,{name:"defaults.webguicss",defaultValue:"pfSense.css",ref:a})))},V=function(e){var a=e.register;return m.a.createElement(m.a.Fragment,null,m.a.createElement("input",{type:"hidden",name:"defaults.sortable",value:"",ref:a}),m.a.createElement("input",{type:"hidden",name:"defaults.varusersusername",value:"",ref:a}),m.a.createElement("input",{type:"hidden",name:"defaults.varuserspassword",value:"",ref:a}),m.a.createElement(f.a.Group,{controlId:"varuserspasswordencryption"},m.a.createElement(f.a.Label,null,"Password Encryption"),m.a.createElement(f.a.Control,{name:"defaults.varuserspasswordencryption",defaultValue:"Cleartext-Password",ref:a})),m.a.createElement(f.a.Group,{controlId:"varuserswisprredirectionurl"},m.a.createElement(f.a.Label,null,"Redirection URL"),m.a.createElement(f.a.Control,{name:"defaults.varuserswisprredirectionurl",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"varuserssimultaneousconnect"},m.a.createElement(f.a.Label,null,"Number of Simultaneous Connections"),m.a.createElement(f.a.Control,{name:"defaults.varuserssimultaneousconnect",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"description"},m.a.createElement(f.a.Label,null,"Description"),m.a.createElement(f.a.Control,{name:"defaults.description",defaultValue:"imported user",ref:a})),m.a.createElement(f.a.Group,{controlId:"varusersframedipaddress"},m.a.createElement(f.a.Label,null,"IPv4 Address"),m.a.createElement(f.a.Control,{name:"defaults.varusersframedipaddress",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"varusersframedipnetmask"},m.a.createElement(f.a.Label,null,"Subnet Mask"),m.a.createElement(f.a.Control,{name:"defaults.varusersframedipnetmask",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"varusersframedroute"},m.a.createElement(f.a.Label,null,"IPv4 Gateway"),m.a.createElement(f.a.Control,{name:"defaults.varusersframedroute",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"varusersframedip6address"},m.a.createElement(f.a.Label,null,"IPv6 Address"),m.a.createElement(f.a.Control,{name:"defaults.varusersframedip6address",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"varusersframedip6route"},m.a.createElement(f.a.Label,null,"IPv6 Gateway"),m.a.createElement(f.a.Control,{name:"defaults.varusersframedip6route",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"varusersvlanid"},m.a.createElement(f.a.Label,null,"VLAN ID"),m.a.createElement(f.a.Control,{name:"defaults.varusersvlanid",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"varusersexpiration"},m.a.createElement(f.a.Label,null,"Expiration Date"),m.a.createElement(f.a.Control,{name:"defaults.varusersexpiration",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"varuserssessiontimeout"},m.a.createElement(f.a.Label,null,"Session Timeout"),m.a.createElement(f.a.Control,{name:"defaults.varuserssessiontimeout",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"varuserslogintime"},m.a.createElement(f.a.Label,null,"Possible Login Times"),m.a.createElement(f.a.Control,{name:"defaults.varuserslogintime",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"varusersamountoftime"},m.a.createElement(f.a.Label,null,"Amount of Time"),m.a.createElement(f.a.Control,{name:"defaults.varusersamountoftime",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"varuserspointoftime"},m.a.createElement(f.a.Label,null,"Time Period"),m.a.createElement(f.a.Control,{name:"defaults.varuserspointoftime",defaultValue:"Daily",ref:a})),m.a.createElement(f.a.Group,{controlId:"varusersmaxtotaloctets"},m.a.createElement(f.a.Label,null,"Amount of Download and Upload Traffic"),m.a.createElement(f.a.Control,{name:"defaults.varusersmaxtotaloctets",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"varusersmaxtotaloctetstimerange"},m.a.createElement(f.a.Label,null,"Bandwidth Time Period"),m.a.createElement(f.a.Control,{name:"defaults.varusersmaxtotaloctetstimerange",defaultValue:"daily",ref:a})),m.a.createElement(f.a.Group,{controlId:"varusersmaxbandwidthdown"},m.a.createElement(f.a.Label,null,"Maximum Bandwidth Down"),m.a.createElement(f.a.Control,{name:"defaults.varusersmaxbandwidthdown",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"varusersmaxbandwidthup"},m.a.createElement(f.a.Label,null,"Maximum Bandwidth Up"),m.a.createElement(f.a.Control,{name:"defaults.varusersmaxbandwidthup",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"varusersacctinteriminterval"},m.a.createElement(f.a.Label,null,"Accounting Interim Interval"),m.a.createElement(f.a.Control,{name:"defaults.varusersacctinteriminterval",defaultValue:"",ref:a})),m.a.createElement(f.a.Group,{controlId:"varuserstopadditionaloptions"},m.a.createElement(f.a.Label,null,"Additional RADIUS Attributes on the TOP of this entry"),m.a.createElement(f.a.Control,{name:"defaults.varuserstopadditionaloptions",as:"textarea",ref:a})),m.a.createElement(f.a.Group,{controlId:"varuserscheckitemsadditionaloptions"},m.a.createElement(f.a.Label,null,"Additional RADIUS Attributes (CHECK-ITEM)"),m.a.createElement(f.a.Control,{name:"defaults.varuserscheckitemsadditionaloptions",as:"textarea",ref:a})),m.a.createElement(f.a.Group,{controlId:"varusersreplyitemsadditionaloptions"},m.a.createElement(f.a.Label,null,"Additional RADIUS Attributes (REPLY-ITEM)"),m.a.createElement(f.a.Control,{name:"defaults.varusersreplyitemsadditionaloptions",as:"textarea",ref:a})))},O={pfsense:{configPath:["system","user"],usernameProp:"name",passwordProp:"bcrypt-hash",passwordHash:function(e){return"password_hash(".concat(e,", PASSWORD_BCRYPT)")}},radius:{configPath:["installedpackages","freeradius","config"],usernameProp:"varusersusername",passwordProp:"varuserspassword",passwordHash:function(e){return e}}},S=function(){var e=Object(u.a)(o.a.mark((function e(a,t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){L.a.parse(a,Object(s.a)(Object(s.a)({},t),{},{complete:e}))})));case 1:case"end":return e.stop()}}),e)})));return function(a,t){return e.apply(this,arguments)}}(),j=function(){var e=JSON.parse(localStorage.getItem("defaultValues"));null===e&&(e={importTo:"pfsense"});var a=Object(C.a)({defaultValues:e}),t=a.handleSubmit,l=a.register,o=Object(c.useState)([]),s=Object(n.a)(o,2),u=s[0],d=s[1],i=Object(c.useState)(""),P=Object(n.a)(i,2),G=P[0],j=P[1],D=Object(c.useState)(e.importTo),T=Object(n.a)(D,2),A=T[0],U=T[1];return m.a.createElement(p.a,null,m.a.createElement(f.a,{onSubmit:t((function(e){var a=e.file,t=e.importTo,r=e.columns,l=e.defaults,o=e.updateDetails,s=e.updatePaswwords;localStorage.setItem("defaultValues",JSON.stringify({importTo:t,columns:r,defaults:l,updateDetails:o,updatePaswwords:s})),S(a[0],{header:!0}).then((function(e){var a=e.data.map((function(e){var a={};return Object.entries(r).forEach((function(t){var r=Object(n.a)(t,2),l=r[0],o=r[1];a[l]=e[o]})),a}));j(function(e){var a=e.defaults,t=e.columns,r=e.data,n=e.target,l=e.updateDetails,o=e.updatePaswwords,s=O[n],u="$config".concat(s.configPath.map((function(e){return"['".concat(e,"']")})).join(""));return'$fields = explode(",", "'.concat(Object.keys(a).join(","),'");\n$defaults = explode(",", "').concat(Object.values(a).join(","),'");\n$header = explode(",", "').concat(t.join(","),'");\n$csv = <<<CSV\n').concat(r,"\nCSV;\n$updateDetails = ").concat(l?"true":"false",";\n$updatePaswwords = ").concat(o?"true":"false",";\nif(!isset(").concat(u,")) {\n  ").concat(u," = array();\n}\n$usernames = array_column(").concat(u,', "').concat(s.usernameProp,'");\nforeach(str_getcsv($csv, "\\n") as $line) {\n  $user = array_merge(\n  \tarray_combine($fields, $defaults),\n  \tarray_combine($header, str_getcsv($line))\n  );\n  $index = array_search($user["').concat(s.usernameProp,'"], $usernames);\n  if($index === false) {\n    $user["').concat(s.passwordProp,'"] = ').concat(s.passwordHash('$user["'.concat(s.passwordProp,'"]')),";\n    ").concat(u,'[] = $user;\n    print("User ${user["').concat(s.usernameProp,'"]} inserted\\n");\n  } else {\n    if($updateDetails || $updatePaswwords) {\n      foreach(array_combine($header, str_getcsv($line)) as $key => $value) {\n        if($updateDetails && $key != "').concat(s.passwordProp,'") {\n          ').concat(u,'[$index][$key] = $value;\n        }\n        if($updatePaswwords && $key == "').concat(s.passwordProp,'") {\n          ').concat(u,"[$index][$key] = ").concat(s.passwordHash("$value"),';\n        }\n      }\n      print("User ${user["').concat(s.usernameProp,'"]} updated\\n");\n    } else {\n      print("User ${user["').concat(s.usernameProp,'"]} ignored\\n");\n    }\n  }\n}\nwrite_config();\nreload_all();')}({data:L.a.unparse(a,{header:!1}),defaults:l,columns:Object.keys(r),target:t,updateDetails:o,updatePaswwords:s}))}))}))},m.a.createElement(E.a,null,m.a.createElement(v.a,{md:6},m.a.createElement(b.a.Container,{defaultActiveKey:"input"},m.a.createElement(w.a,null,m.a.createElement(w.a.Header,null,m.a.createElement(h.a,{variant:"tabs",className:"card-header-tabs"},m.a.createElement(h.a.Item,null,m.a.createElement(h.a.Link,{eventKey:"input"},"Input options")),m.a.createElement(h.a.Item,null,m.a.createElement(h.a.Link,{eventKey:"defaults"},"Default values")),m.a.createElement(h.a.Item,null,m.a.createElement(h.a.Link,{eventKey:"options"},"Options")))),m.a.createElement(w.a.Body,null,m.a.createElement(b.a.Content,null,m.a.createElement(b.a.Pane,{eventKey:"input"},m.a.createElement(f.a.Group,{controlId:"file"},m.a.createElement(f.a.Label,null,"CSV File"),m.a.createElement(f.a.Control,{name:"file",type:"file",ref:l,onChange:function(e){L.a.parse(e.currentTarget.files[0],{preview:1,complete:function(e){return d([""].concat(Object(r.a)(e.data[0])))}})},required:!0})),m.a.createElement(f.a.Group,{controlId:"importTo"},m.a.createElement(f.a.Label,null,"Import to"),m.a.createElement(f.a.Control,{name:"importTo",as:"select",ref:l,onChange:function(e){return U(e.currentTarget.value)},required:!0},m.a.createElement("option",{value:"pfsense"},"Local user database"),m.a.createElement("option",{value:"radius"},"FreeRADIUS user database"))),"radius"===A?m.a.createElement(x,{columns:u,register:l}):m.a.createElement($,{columns:u,register:l})),m.a.createElement(b.a.Pane,{eventKey:"defaults"},"radius"===A?m.a.createElement(V,{register:l}):m.a.createElement(k,{register:l})),m.a.createElement(b.a.Pane,{eventKey:"options"},m.a.createElement(f.a.Group,null,m.a.createElement(f.a.Check,{label:"Update existing user details",name:"updateDetails",ref:l})),m.a.createElement(f.a.Group,null,m.a.createElement(f.a.Check,{label:"Update existing user password",name:"updatePaswwords",ref:l}))))),m.a.createElement(w.a.Footer,null,m.a.createElement(b.a.Content,null,m.a.createElement(y.a,{type:"submit",variant:"primary"},"Generate PHP script")))))),m.a.createElement(v.a,{md:6},m.a.createElement(w.a,null,m.a.createElement(I.a,{variant:"warning",className:"mb-0"},m.a.createElement(I.a.Link,{href:"https://docs.netgate.com/pfsense/en/latest/diagnostics/command-prompt.html#php-execute",target:"_blank"},"Running PHP commands on pfSense")),m.a.createElement(w.a.Header,null,"Generated Script"),m.a.createElement(w.a.Body,null,m.a.createElement(f.a.Group,null,m.a.createElement(f.a.Control,{as:"textarea",rows:10,wrap:"off",value:G,disabled:!G,readOnly:!0})),m.a.createElement(g.CopyToClipboard,{text:G},m.a.createElement(y.a,{variant:"primary",disabled:!G},"Copy"))))))))};i.a.render(m.a.createElement(j,null),document.getElementById("root"))}},[[42,1,2]]]);
//# sourceMappingURL=main.b8ef04ed.chunk.js.map